<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=LXGW+WenKai+Mono+TC&display=swap');
    </style>
    <h1 class="page-title">載物小畢典</h1>
</head>
<body class="level-6-bg">
    <div class="corner-image"></div>

    <!-- 創建角色 -->
    <img id="levelCharacter" src="../images/character.png" alt="Character" style="position: absolute; width: 40px; height: 40px;" />

    <button id="backToMainBtn">返回主頁</button>

    <p class="corner-text">照片是24的，25明年上線</p>

    <!-- 小相簿模態視窗 -->
        <div id="albumModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); justify-content: center; align-items: center;">
            <div class="album-content" style="position: relative; background: white; padding: 20px; max-width: 500px; max-height: 500px; text-align: center;">
                <img id="albumImage" style="max-width: 100%; max-height: 400px;"/>
                
                <div style="margin-top: 10px;">
                    <button id="prevPhotoBtn">上一張</button>
                    <button id="nextPhotoBtn">下一張</button>
                </div>
                <button id="closeAlbumBtn" style="position: absolute; top: 10px; right: 10px;">關閉</button>
            </div>
        </div>
        

    <script>
    // 角色初始位置
    let characterX = 100;
    let characterY = 100;
    let speed = 5;  // 角色移動速度
    let activeDialogueBox = null;

    // 顯示角色
    const character = document.getElementById('levelCharacter');
    character.style.left = `${characterX}px`;
    character.style.top = `${characterY}px`;

    const levelConfig2 = {
    missions: [
        { point: { x: 350, y: 200 }, albumKey: 'D', imageUrl: 'images/24小畢典/A1.jpg', touch:0 },
    ]
    };

    
    // 創建任務點
function createMissionPoint(levelConfig2) {
    levelConfig2.missions.forEach((mission) => {
        const missionPoint = document.createElement('div');
        missionPoint.style.position = 'absolute';
        missionPoint.style.left = `${mission.point.x}px`;
        missionPoint.style.top = `${mission.point.y}px`;
        missionPoint.style.width = '40px';
        missionPoint.style.height = '40px';
        missionPoint.style.borderRadius = '50%';
        missionPoint.style.zIndex = '2';

        // 設定背景圖片或默認顏色
        if (mission.imageUrl) {
            missionPoint.style.backgroundImage = `url('${mission.imageUrl}')`;
            missionPoint.style.backgroundSize = 'cover';
            missionPoint.style.backgroundPosition = 'center';
        } else {
            missionPoint.style.backgroundColor = 'red';  // 默認紅色
        }

        // 設置 albumKey 到 dataset 中以便碰撞檢測中使用
        missionPoint.dataset.albumKey = mission.albumKey;
        
        document.body.appendChild(missionPoint);
    });
}


    // 顯示第二關的任務點
    createMissionPoint(levelConfig2);

    // 角色移動
    function updateCharacterPosition() {
        character.style.left = `${characterX}px`;
        character.style.top = `${characterY}px`;
        checkCollisionWithMissions(characterX, characterY);
    }

    // 鍵盤事件處理器
    document.addEventListener('keydown', (event) => {
        switch (event.key) {
            case 'ArrowUp':
                characterY -= speed;
                break;
            case 'ArrowDown':
                characterY += speed;
                break;
            case 'ArrowLeft':
                characterX -= speed;
                break;
            case 'ArrowRight':
                characterX += speed;
                break;
        }
        updateCharacterPosition();  // 每次移動更新角色位置
    });

    function checkCollisionWithMissions(x, y) {
    console.log("Check for collision function entered");

    levelConfig2.missions.forEach((mission) => {
        const { point, albumKey } = mission;  // 從 mission 中取得 albumKey 和座標
        const distance = Math.sqrt((x - point.x) ** 2 + (y - point.y) ** 2);

        if (distance < 40 && mission.touch === 0) {  // 若距離小於40且未觸發過相簿
            if (albumKey) {
                showImage('images/24小畢典/A1.jpg');
                mission.touch = 1;  
            }
        } else if (distance > 80 && mission.touch === 1) {  
            console.log("Left mission area");
            mission.touch = 0;  
        }
    });
}

function showImage(imageUrl) {
        // 創建 img 元素
        const img = document.createElement("img");

        // 設定圖片的來源與樣式
        img.src = imageUrl;
        img.style.position = "fixed"; // 固定位置
        img.style.top = "50%"; // 垂直置中
        img.style.left = "50%"; // 水平置中
        img.style.transform = "translate(-50%, -50%)"; // 讓圖片中心對齊
        img.style.width = "300px"; // 設定圖片寬度
        img.style.height = "auto"; // 高度自動調整，保持比例
        img.style.zIndex = "1000"; // 確保圖片在最前面
        img.style.boxShadow = "0 4px 8px rgba(0, 0, 0, 0.2)"; // 添加陰影效果
        img.style.borderRadius = "10px"; // 添加圓角

        // 添加到頁面
        document.body.appendChild(img);

        // 在 3 秒後自動移除圖片
        setTimeout(() => {
            img.remove();
        }, 3000); // 3000 毫秒 = 3 秒
    }

    </script>

    <script>
    // 返回主頁按鈕
    document.getElementById('backToMainBtn').addEventListener('click', () => {
        window.location.href = 'index.html'; 
    });
    </script>
</body>
</html>
